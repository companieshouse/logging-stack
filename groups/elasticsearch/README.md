# elasticsearch

Provisions the core ElasticSearch infrastructure

## Terraform variables

| Name                          | Description                                                                                                                                                                                                                                                                                                                                                                 | Default                                  | Example                                                                                                                                                                                                                                                                                                                                | Notes              |
| ----------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------ |
| account_name                  | The name of the AWS account we're using                                                                                                                                                                                                                                                                                                                                     | `-`                                      | `development`                                                                                                                                                                                                                                                                                                                          | -                  |
| ami_owner_id                  | The ID of the AMI owner                                                                                                                                                                                                                                                                                                                                                     | `-`                                      | `12345`                                                                                                                                                                                                                                                                                                                                | -                  |
| data_cold_ami_version_pattern | The patterns with which to match elasticsearch AMIs for cold data instances                                                                                                                                                                                                                                                                                                 | `-`                                      | `{"blue": "\\d.\\d.\\d","green": "\\d.\\d.\\d"}`                                                                                                                                                                                                                                                                                       | -                  |
| data_cold_instance_count      | The number of cold data instances to provision                                                                                                                                                                                                                                                                                                                              | `-`                                      | `{"blue": 3,"green": 0}`                                                                                                                                                                                                                                                                                                               | -                  |
| data_cold_instance_type       | The instance type to use for cold data nodes                                                                                                                                                                                                                                                                                                                                | `-`                                      | `{"blue": "t3.medium","green": "t3.medium"}`                                                                                                                                                                                                                                                                                           | -                  |
| data_cold_lvm_block_devices   | LVM block devices for cold data nodes                                                                                                                                                                                                                                                                                                                                       | `-`                                      | `{"blue": [{aws_volume_size_gb: "10",filesystem_resize_tool: "xfs_growfs",lvm_logical_volume_device_node: "/dev/abc",lvm_physical_volume_device_node: "/dev/def"}],"green": [{aws_volume_size_gb: "10",filesystem_resize_tool: "xfs_growfs",lvm_logical_volume_device_node: "/dev/abc",lvm_physical_volume_device_node: "/dev/def"}]}` | -                  |
| data_cold_roles               | The roles to assign to cold data nodes                                                                                                                                                                                                                                                                                                                                      | `["data_cold","data_content"]`           | `["role_a","role_b"]`                                                                                                                                                                                                                                                                                                                  | -                  |
| data_cold_root_volume_size    | The size of the root volume for cold data nodes in GiB; set this value to 0 to preserve the size specified in the AMI metadata. This value should not be smaller than the size specified in the AMI metadata and used by the root volume snapshot. The filesystem will be expanded automatically to use all available space for the volume and an XFS filesystem is assumed | `-`                                      | `{"blue": 1,"green": 0}`                                                                                                                                                                                                                                                                                                               | -                  |
| data_hot_ami_version_pattern  | The patterns with which to match elasticsearch AMIs for hot data instances                                                                                                                                                                                                                                                                                                  | `-`                                      | `{"blue": "\\d.\\d.\\d","green": "\\d.\\d.\\d"}`                                                                                                                                                                                                                                                                                       | -                  |
| data_hot_instance_count       | The number of hot data instances to provision                                                                                                                                                                                                                                                                                                                               | `-`                                      | `{"blue": 1,"green": 1}`                                                                                                                                                                                                                                                                                                               | -                  |
| data_hot_instance_type        | The instance type to use for hot data nodes                                                                                                                                                                                                                                                                                                                                 | `-`                                      | `{"blue": "t3.large","green": "t3.large"}`                                                                                                                                                                                                                                                                                             | -                  |
| data_hot_lvm_block_devices    | LVM block devices for hot data nodes                                                                                                                                                                                                                                                                                                                                        | `-`                                      | `{"blue": [{aws_volume_size_gb: "10",filesystem_resize_tool: "xfs_growfs",lvm_logical_volume_device_node: "/dev/abc",lvm_physical_volume_device_node: "/dev/def"}],"green": [{aws_volume_size_gb: "10",filesystem_resize_tool: "xfs_growfs",lvm_logical_volume_device_node: "/dev/abc",lvm_physical_volume_device_node: "/dev/def"}]}` | -                  |
| data_hot_roles                | The roles to assign to hot data nodes                                                                                                                                                                                                                                                                                                                                       | `["data_hot","ingest"]`                  | `["role_a","role_b"]`                                                                                                                                                                                                                                                                                                                  | -                  |
| data_hot_root_volume_size     | The size of the root volume for hot data nodes in GiB; set this value to 0 to preserve the size specified in the AMI metadata. This value should not be smaller than the size specified in the AMI metadata and used by the root volume snapshot. The filesystem will be expanded automatically to use all available space for the volume and an XFS filesystem is assumed  | `-`                                      | `{"blue": 0,"green": 0}`                                                                                                                                                                                                                                                                                                               | -                  |
| data_warm_ami_version_pattern | The patterns with which to match elasticsearch AMIs for warm data instances                                                                                                                                                                                                                                                                                                 | `-`                                      | `{"blue": "\\d.\\d.\\d","green": "\\d.\\d.\\d"}`                                                                                                                                                                                                                                                                                       | -                  |
| data_warm_instance_count      | The number of warm data instances to provision                                                                                                                                                                                                                                                                                                                              | `-`                                      | `{"blue": 3,"green": 0}`                                                                                                                                                                                                                                                                                                               | -                  |
| data_warm_instance_type       | The instance type to use for warm data nodes                                                                                                                                                                                                                                                                                                                                | `-`                                      | `{"blue": "t3.medium","green": "t3.medium"}`                                                                                                                                                                                                                                                                                           | -                  |
| data_warm_lvm_block_devices   | LVM block devices for warm data nodes                                                                                                                                                                                                                                                                                                                                       | `-`                                      | `{"blue": [{aws_volume_size_gb: "10",filesystem_resize_tool: "xfs_growfs",lvm_logical_volume_device_node: "/dev/abc",lvm_physical_volume_device_node: "/dev/def"}],"green": [{aws_volume_size_gb: "10",filesystem_resize_tool: "xfs_growfs",lvm_logical_volume_device_node: "/dev/abc",lvm_physical_volume_device_node: "/dev/def"}]}` | -                  |
| data_warm_roles               | The roles to assign to warm data nodes                                                                                                                                                                                                                                                                                                                                      | `["data_warm"]`                          | `["role_a","role_b"]`                                                                                                                                                                                                                                                                                                                  | -                  |
| data_warm_root_volume_size    | The size of the root volume for warm data nodes in GiB; set this value to 0 to preserve the size specified in the AMI metadata. This value should not be smaller than the size specified in the AMI metadata and used by the root volume snapshot. The filesystem will be expanded automatically to use all available space for the volume and an XFS filesystem is assumed | `-`                                      | `{"blue": 0,"green": 0}`                                                                                                                                                                                                                                                                                                               | -                  |
| deployments                   | The list of deployments to provision                                                                                                                                                                                                                                                                                                                                        | `["blue","green"]`                       | `["orange","yellow"]`                                                                                                                                                                                                                                                                                                                  | -                  |
| environment                   | The environment name to be used when creating AWS resources                                                                                                                                                                                                                                                                                                                 | `-`                                      | `my_environment`                                                                                                                                                                                                                                                                                                                       | -                  |
| master_ami_version_pattern    | The patterns with which to match elasticsearch AMIs for master instances                                                                                                                                                                                                                                                                                                    | `-`                                      | `{"blue": "\\d.\\d.\\d","green": "\\d.\\d.\\d"}`                                                                                                                                                                                                                                                                                       | -                  |
| master_instance_count         | The number of master instances to provision                                                                                                                                                                                                                                                                                                                                 | `-`                                      | `{"blue": 3,"green": 0}`                                                                                                                                                                                                                                                                                                               | `Never go below 3` |
| master_instance_type          | The instance type to use for master nodes                                                                                                                                                                                                                                                                                                                                   | `-`                                      | `{"blue": "c5.large","green": "c5.large"}`                                                                                                                                                                                                                                                                                             | -                  |
| master_lvm_block_devices      | LVM block devices for master nodes                                                                                                                                                                                                                                                                                                                                          | `-`                                      | `{"blue": [{aws_volume_size_gb: "10",filesystem_resize_tool: "xfs_growfs",lvm_logical_volume_device_node: "/dev/abc",lvm_physical_volume_device_node: "/dev/def"}],"green": [{aws_volume_size_gb: "10",filesystem_resize_tool: "xfs_growfs",lvm_logical_volume_device_node: "/dev/abc",lvm_physical_volume_device_node: "/dev/def"}]}` | -                  |
| master_roles                  | The roles to assign to master nodes                                                                                                                                                                                                                                                                                                                                         | `["master"]`                             | `["role_a","role_b"]`                                                                                                                                                                                                                                                                                                                  | -                  |
| master_root_volume_size       | The size of the root volume for master nodes in GiB; set this value to 0 to preserve the size specified in the AMI metadata. This value should not be smaller than the size specified in the AMI metadata and used by the root volume snapshot. The filesystem will be expanded automatically to use all available space for the volume and an XFS filesystem is assumed    | `-`                                      | `{"blue": 0,"green": 0}`                                                                                                                                                                                                                                                                                                               | -                  |
| region                        | The AWS region in which resources will be administered                                                                                                                                                                                                                                                                                                                      | `-`                                      | `eu-west-2`                                                                                                                                                                                                                                                                                                                            | -                  |
| repository_name               | The name of the repository in which we're operating                                                                                                                                                                                                                                                                                                                         | `-`                                      | `logging-stack`                                                                                                                                                                                                                                                                                                                        | `deprecated`       |
| service                       | The service name to be used when creating AWS resources                                                                                                                                                                                                                                                                                                                     | `logging`                                | `-`                                                                                                                                                                                                                                                                                                                                    | -                  |
| service_group                 | The Linux group name for association with elasticsearch configuration files                                                                                                                                                                                                                                                                                                 | `elasticsearch`                          | `my_group`                                                                                                                                                                                                                                                                                                                             | -                  |
| service_user                  | The Linux username for ownership of elasticsearch configuration files                                                                                                                                                                                                                                                                                                       | `elasticsearch`                          | `my_user`                                                                                                                                                                                                                                                                                                                              | -                  |
| team                          | The team responsible for administering the instance                                                                                                                                                                                                                                                                                                                         | `-`                                      | `platform`                                                                                                                                                                                                                                                                                                                             | -                  |
| user_data_merge_strategy      | Merge strategy to apply to user-data sections for cloud-init                                                                                                                                                                                                                                                                                                                | `list(append)+dict(recurse_array)+str()` | `-`                                                                                                                                                                                                                                                                                                                                    | -                  |
